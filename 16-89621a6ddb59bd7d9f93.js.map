{"version":3,"sources":["webpack:///./src/components/shared/Button.js","webpack:///./node_modules/core-js/modules/es6.regexp.to-string.js","webpack:///./node_modules/core-js/modules/_flags.js","webpack:///./node_modules/core-js/modules/es6.object.keys.js","webpack:///./node_modules/core-js/modules/_object-sap.js","webpack:///./node_modules/core-js/modules/es6.regexp.flags.js","webpack:///./src/apps/tableRoller/parseTable.js","webpack:///./src/apps/tableRoller/components.js","webpack:///./src/apps/AppErrorBoundry.js","webpack:///./src/apps/tableRoller/TableRoller.js"],"names":["styled_components__WEBPACK_IMPORTED_MODULE_0__","__webpack_require__","_styles_reset__WEBPACK_IMPORTED_MODULE_1__","_styles_colors__WEBPACK_IMPORTED_MODULE_2__","Button","styled","button","withConfig","displayName","componentId","inputReset","colors","anObject","$flags","DESCRIPTORS","$toString","define","fn","RegExp","prototype","call","source","flags","R","this","concat","undefined","name","module","exports","that","result","global","ignoreCase","multiline","unicode","sticky","toObject","$keys","it","$export","core","fails","KEY","exec","Object","exp","S","F","f","configurable","get","getText","node","textContent","nodeListToArray","nodeList","slice","childNodesToArray","parentContainer","childNodes","map","parseTable","tableDom","headers","querySelector","rowsByKey","querySelectorAll","bodyRow","zipObject","tableData","reduce","data","key","i","_Object$assign","assign","row","StyledTableRoller","div","StyledButtonsContainer","RollerButton","StyledResult","StyledResultValue","StyledResultTitle","span","ErrorContainer","AppErrorBoundary","state","hasError","errorDetails","getDerivedStateFromError","error","render","_this$state","react_default","a","createElement","toString","props","children","Component","TableRollerButtons","_ref","buttons","rollResult","_ref2","title","fields","buttonClass","onClick","className","TableRollerResult","_ref3","toPairs","_ref4","value","contains","array","indexOf","hasColon","hasCurlyBrace","omitMetaValues","omitBy","_","startsWith","rollFieldValue","_ref5","defaultResult","_splitColon","split","dice","val1","val2","roll","directive","droll","min","rolls","max","total","rollDice","diceRoll","iterpolateField","_ref6","filter","s","part","fieldArray","rollField","length","join","_ref7","fieldValue","TableRoller","results","componentDidMount","_this$props","_this$props$table","table","allHeaders","allData","forEach","tableId","markerId","document","nextElementSibling","_parseTable","additionalData","JSON","parse","keys","setState","_this$state$tableData","_this$state$headers","fieldsWithDefault","acc","header","resultType","_ref8","defultRoll","mapValues","getResult","console","_this2","_this$state2","buttonsArray","TableRoller_TableRollerButtons","TableRoller_TableRollerResult","__webpack_exports__","AppErrorBoundry","TableRoller_TableRoller"],"mappings":"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","file":"16-89621a6ddb59bd7d9f93.js","sourcesContent":["import styled from 'styled-components';\nimport { inputReset } from '../styles/reset';\nimport * as colors from '../styles/colors';\n\nconst Button = styled.button`\n    ${inputReset}\n\n    padding: 0.25em 0.75em;\n    font-weight: 600;\n    background: ${colors.highlightAlt};\n    color: white;\n\n    border-radius: 3px;\n    cursor: pointer;\n\n    outline: none;\n\n    &: hover {\n        background: ${colors.highlight};\n    }\n`\n\nexport default Button;\n","'use strict';\nrequire('./es6.regexp.flags');\nvar anObject = require('./_an-object');\nvar $flags = require('./_flags');\nvar DESCRIPTORS = require('./_descriptors');\nvar TO_STRING = 'toString';\nvar $toString = /./[TO_STRING];\n\nvar define = function (fn) {\n  require('./_redefine')(RegExp.prototype, TO_STRING, fn, true);\n};\n\n// 21.2.5.14 RegExp.prototype.toString()\nif (require('./_fails')(function () { return $toString.call({ source: 'a', flags: 'b' }) != '/a/b'; })) {\n  define(function toString() {\n    var R = anObject(this);\n    return '/'.concat(R.source, '/',\n      'flags' in R ? R.flags : !DESCRIPTORS && R instanceof RegExp ? $flags.call(R) : undefined);\n  });\n// FF44- RegExp#toString has a wrong name\n} else if ($toString.name != TO_STRING) {\n  define(function toString() {\n    return $toString.call(this);\n  });\n}\n","'use strict';\n// 21.2.5.3 get RegExp.prototype.flags\nvar anObject = require('./_an-object');\nmodule.exports = function () {\n  var that = anObject(this);\n  var result = '';\n  if (that.global) result += 'g';\n  if (that.ignoreCase) result += 'i';\n  if (that.multiline) result += 'm';\n  if (that.unicode) result += 'u';\n  if (that.sticky) result += 'y';\n  return result;\n};\n","// 19.1.2.14 Object.keys(O)\nvar toObject = require('./_to-object');\nvar $keys = require('./_object-keys');\n\nrequire('./_object-sap')('keys', function () {\n  return function keys(it) {\n    return $keys(toObject(it));\n  };\n});\n","// most Object methods by ES6 should accept primitives\nvar $export = require('./_export');\nvar core = require('./_core');\nvar fails = require('./_fails');\nmodule.exports = function (KEY, exec) {\n  var fn = (core.Object || {})[KEY] || Object[KEY];\n  var exp = {};\n  exp[KEY] = exec(fn);\n  $export($export.S + $export.F * fails(function () { fn(1); }), 'Object', exp);\n};\n","// 21.2.5.3 get RegExp.prototype.flags()\nif (require('./_descriptors') && /./g.flags != 'g') require('./_object-dp').f(RegExp.prototype, 'flags', {\n  configurable: true,\n  get: require('./_flags')\n});\n","import { zipObject } from 'lodash';\n\nconst getText = (node) => node.textContent;\nconst nodeListToArray = (nodeList) => [].slice.call(nodeList);\n\nconst childNodesToArray = (parentContainer) => {\n    const ths = nodeListToArray(parentContainer.childNodes);\n    return ths.map(getText);\n};\n\nconst parseTable = (tableDom) => {\n    const headers = childNodesToArray(tableDom.querySelector('thead tr'));\n    const bodyRows = nodeListToArray(tableDom.querySelectorAll('tbody tr')).map(childNodesToArray);\n\n    const rowsByKey = bodyRows.map((bodyRow) => zipObject(headers, bodyRow));\n\n    const tableData = headers.reduce((data, key, i) => ({\n        ...data,\n        [key]: rowsByKey.map(row => row[key]),\n    }), {});\n\n    return {\n        headers,\n        tableData,\n    };\n};\n\nexport default parseTable;\n","import styled from 'styled-components';\nimport Button from '../../components/shared/Button';\n\nexport const StyledTableRoller = styled.div`\n    margin: 2rem 0;\n    border: 1px solid lightgrey;\n`\nexport const StyledButtonsContainer = styled.div`\n    position: relative;\n    padding: 0.5rem;\n\n    &:after {\n        position: absolute;\n        top: -0.35rem;\n        right: 0.8rem;\n        content: '⚄';\n        font-size: 2rem;\n        color: grey;\n    }\n`\nexport const RollerButton = styled(Button)`\n    margin-right: 0.5rem;\n\n    &.secondary {\n        background: grey;\n\n        &:hover {\n            background: red;\n        }\n    }\n`\n\nexport const StyledResult = styled.div`\n    padding: 0.5rem;\n\n    border-top: 1px solid lightgrey;\n    background: #eee;\n`\n\nexport const StyledResultValue = styled.div`\n    margin-bottom: 0.25rem;\n`\n\nexport const StyledResultTitle = styled.span`\n    font-weight: 600;\n    margin-right: 0.25rem;\n`\n","import React, { Component } from 'react';\nimport styled from 'styled-components';\n\nexport const ErrorContainer = styled.div`\n    border: 1px solid red;\n    padding: 0.5rem;\n`\n\nclass AppErrorBoundary extends Component {\n    state = { hasError: false, errorDetails: null };\n\n    static getDerivedStateFromError(error) {\n        return { hasError: true, errorDetails: error };\n    }\n\n    render() {\n        const { hasError, errorDetails } = this.state;\n\n        if (hasError) {\n            return (\n                <ErrorContainer>\n                    {errorDetails.toString()}\n                </ErrorContainer>\n            );\n        }\n\n        return this.props.children;\n    }\n}\n\nexport default AppErrorBoundary;\n","import React, { Component } from 'react';\nimport styled from 'styled-components';\nimport {\n    toPairs,\n    omit,\n    mapKeys,\n    mapValues,\n    sample,\n    reduce,\n    omitBy,\n    startsWith,\n    min,\n    max,\n} from 'lodash/fp';\n\nimport droll from 'droll';\n\nimport parseTable from './parseTable';\n\nimport {\n    StyledTableRoller,\n    StyledButtonsContainer,\n    RollerButton,\n    StyledResult,\n    StyledResultValue,\n    StyledResultTitle,\n} from './components';\n\nimport AppErrorBoundary, { ErrorContainer } from '../AppErrorBoundry';\n\nconst TableRollerButtons = ({ buttons, rollResult }) => (\n    <StyledButtonsContainer>\n        {buttons.map(([title, fields], i) => {\n            const buttonClass = fields['~~buttonStyle'];\n            return (\n                <RollerButton key={i} onClick={() => rollResult(fields)} className={buttonClass}>{title}</RollerButton>\n            );\n        })}\n    </StyledButtonsContainer>\n);\n\nconst TableRollerResult = ({ result }) => (\n    <StyledResult>\n        {toPairs(result)\n            .map(([key, value], i) => (\n            <StyledResultValue key={i}>\n                <StyledResultTitle>{key}: </StyledResultTitle>\n                <span>{value}</span>\n            </StyledResultValue>\n        ))}\n    </StyledResult>\n);\n\nconst contains = (value) => (array) => array.indexOf(value) > -1;\n\nconst hasPipe = contains('|');\nconst splitPipe = (string) => string.split('|');\n\nconst hasColon = contains(':')\nconst splitColon = (string) => string.split(':');\n\nconst hasCurlyBrace = contains('{');\n\nconst omitMetaValues = omitBy((_, key) => startsWith('~~', key));\n\nconst findTable = (markerId) => {\n    const tableMarker = document.querySelector(`*[data-table-marker=\"${markerId}\"]`);\n    return tableMarker.nextElementSibling;\n};\n\nconst rollDice = (dice, directive) => {\n    const roll = droll.roll(dice);\n\n    switch (directive) {\n        case 'lowest':\n            return min(roll.rolls);\n        case 'highest':\n            return max(roll.rolls);\n        default:\n            return roll.total;\n    }\n}\n\nconst rollFieldValue = ({ defaultResult, tableData, headers }) => (value) => {\n    if (contains(value)(headers)) {\n        return tableData[value][defaultResult];\n    }\n\n    if (hasColon(value)) {\n        const [dice, val1, val2] = splitColon(value);\n        const key = val2 || val1;\n        const directive = val2 ? val1 : undefined;\n\n        const roll = rollDice(dice, directive) - 1;\n        return tableData[key][roll];\n    }\n\n    const diceRoll = droll.roll(value).total;\n    if (diceRoll) return diceRoll.toString();\n};\n\nconst iterpolateField = ({ defaultResult, tableData, fields, headers }) => (value) => {\n    const parts = value.split(/{([^}]+)}/g).filter((s) => !!s);\n\n    return parts.map(part => {\n        if (!contains(part)(headers)) return `${part}`;\n\n        const fieldArray = tableData[part];\n        if (!fieldArray) return part;\n\n        const rolledValue = rollField({ defaultResult, tableData, headers })(`d${fieldArray.length}:${part}`);\n\n        return rolledValue || part;\n    })\n    .join('');\n};\n\nconst rollField = ({ defaultResult, tableData, fields, headers }) => (value) => {\n    const fieldValue = rollFieldValue({ defaultResult, tableData, headers })(value);\n\n    if (fieldValue && hasCurlyBrace(fieldValue)) {\n        return iterpolateField({ defaultResult, tableData, fields, headers })(fieldValue);\n    }\n\n    return fieldValue;\n};\n\nconst getResult = ({ tableData, fields, headers }) => {\n    const defultRoll = fields['~~roll'] || `d${tableData[headers[0]].length}`;\n    const defaultResult = droll.roll(defultRoll).total - 1;\n\n    return mapValues(rollField({ defaultResult, tableData, fields, headers }))(omitMetaValues(fields));\n};\n\nclass TableRoller extends Component {\n    state = { results: [] };\n\n    componentDidMount() {\n        const { table = '', data } = this.props;\n\n        let allHeaders = [];\n        let allData = {};\n\n        const tablesIds = table.split(',');\n        tablesIds.forEach((tableId) => {\n            const tableDom = findTable(tableId);\n            const { headers, tableData } = parseTable(tableDom);\n\n            allHeaders = [...allHeaders, ...headers];\n            allData = {...allData, ...tableData};\n        })\n\n        const additionalData = data && JSON.parse(data) || {};\n\n        allHeaders = [...allHeaders, ...Object.keys(additionalData)];\n        allData = {...allData, ...additionalData};\n\n        this.setState({\n            headers: allHeaders,\n            tableData: allData,\n        });\n    }\n\n    rollResult(fields) {\n        try {\n            const { tableData = {}, headers = [], results } = this.state;\n\n            const fieldsWithDefault = fields || headers.reduce((acc, header) => ({ ...acc, [header]: header }), {});\n\n            const resultType = fields['~~resultType'] || 'replace';\n            const result = getResult({ tableData, headers, fields: fieldsWithDefault });\n\n            this.setState({\n                results: resultType === 'append' ?\n                    [...results, result] :\n                    [result],\n            });\n        } catch (error) {\n            console.error(error);\n            this.setState({ error });\n        }\n    }\n\n    render() {\n        const { buttons } = this.props;\n        const { tableData, results, error } = this.state;\n\n        if (error) return <ErrorContainer>{error.toString()}</ErrorContainer>;\n\n        const buttonsArray = buttons && JSON.parse(buttons);\n\n        return (\n            <StyledTableRoller>\n                <TableRollerButtons buttons={buttonsArray} rollResult={(fields) => this.rollResult(fields)} />\n                {results.map((result, i) => (\n                    <TableRollerResult key={i} result={result} />\n                ))}\n            </StyledTableRoller>\n        );\n    }\n}\n\nexport default (props) => <AppErrorBoundary><TableRoller {...props} /></AppErrorBoundary>;\n"],"sourceRoot":""}